<h4 mat-dialog-title
    cdkDrag
    cdkDragRootElement=".cdk-overlay-pane"
    cdkDragHandle>
    <div class="ui-dialog-titlebar ui-corner-all ui-widget-header ui-helper-clearfix ui-draggable-handle themeBackground">

        <span class="ui-dialog-title" style="color: white; ">Element Selector</span>
        <button type="button" class="ui-button ui-corner-all ui-widget ui-button-icon-only ui-dialog-titlebar-close" style="float: right; margin: 5px;" (click)="closeHelp()" title="Close"><span class="ui-button-icon ui-icon ui-icon-closethick"></span><span class="ui-button-icon-space"> </span>Close</button>

    </div>

</h4>
<mat-dialog-content style="height: 100%">

    <!--  <div style='margin-left: 20px;'><a style='font-weight: bold;' href="{{data.validTypesToSelect}}" target='_blank'>Open in New Window</a></div>-->
    <div style="width: 100% !important;">
        <div class="row" style="margin-bottom: 10px;">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12" style="margin-top: 10px;" *ngIf="formData.step === 0">
                What type of element are you looking for?
                <div style="margin-top: 10px;">
                    <ul class="list-group" style="cursor: pointer;">
                        <li class="list-group-item" ng-hide="hideOptions['Folder']">
                            <div class="radio" style="margin: 0px !important;" (click)="onElementTypeSelect('Folder')">
                                <label>
                                    <input type="radio"
                                           ng-model="formData.selectedType"
                                           style="cursor: pointer;"
                                           ng-value="'Folder'">Folder
                                </label>
                            </div>
                        </li>
                        <li class="list-group-item" ng-hide="hideOptions['DataType']">
                            <div class="radio" style="margin: 0px !important;" (click)="onElementTypeSelect('DataType')">
                                <label>
                                    <input type="radio"
                                           ng-model="formData.selectedType"
                                           style="cursor: pointer;"
                                           ng-value="'DataType'">Data Type
                                </label>
                            </div>
                        </li>
                        <li class="list-group-item" ng-hide="hideOptions['DataModel']">
                            <div class="radio" style="margin: 0px !important;" (click)="onElementTypeSelect('DataModel')">
                                <label>
                                    <input type="radio"
                                           ng-model="formData.selectedType"
                                           style="cursor: pointer;"
                                           ng-value="'DataModel'">Data Model
                                </label>
                            </div>
                        </li>
                        <li class="list-group-item" ng-hide="hideOptions['DataClass']">
                            <div class="radio" style="margin: 0px !important;" (click)="onElementTypeSelect('DataClass')">
                                <label>
                                    <input type="radio"
                                           ng-model="formData.selectedType"
                                           style="cursor: pointer;"
                                           ng-value="'DataClass'">Data Class
                                </label>
                            </div>
                        </li>
                        <li class="list-group-item" ng-hide="hideOptions['DataElement']">
                            <div class="radio" style="margin: 0px !important;" (click)="onElementTypeSelect('DataElement')">
                                <label>
                                    <input type="radio"
                                           ng-model="formData.selectedType"
                                           style="cursor: pointer;"
                                           ng-value="'DataElement'">Data Element
                                </label>
                            </div>
                        </li>
                        <li class="list-group-item" ng-hide="hideOptions['Term']">
                            <div class="radio" style="margin: 0px !important;" (click)="onElementTypeSelect('Term')">
                                <label>
                                    <input type="radio"
                                           ng-model="formData.selectedType"
                                           style="cursor: pointer;"
                                           ng-value="'Term'">Term
                                </label>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12" style="margin-top: 10px;padding-right: 0px;padding-left: 0px;" *ngIf="formData.step === 1">

        <div *ngIf="formData.selectedType ===  'DataModel'">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div style="margin-bottom: 10px;">
                    Please select a {{formData.selectedType}} ?
                </div>

                <input type="text"
                       class="form-control input-sm"
                       [(ngModel)]="formData.treeSearchText"
                       placeholder="Search"
                       (input)="searchInTree('DataModel')"
                       [ngModelOptions]='{ debounce: 500 }'>
                <div style="width: 100%; height: 300px;overflow-y: auto;border: 1px solid #DDD;">
                    <div>
                        <mdm-folders-tree
                            [inSearchMode] = "formData.inSearchMode"
                            [doNotMakeSelectedBold]="true"
                            [justShowFolders]="true"
                            [doNotShowDataClasses]="true"
                            [expandOnNodeClickFor]="['Folder']"
                            (nodeClickEvent)="onNodeInTreeSelect($event)"
                             [node]="rootNode"></mdm-folders-tree>
                    </div>
                </div>
            </div>
            <div style="margin-top: 10px;" *ngIf="showPrevBtn">
                <button class="btn btn-default btn-xs modelSelectorDialogueBtn" (click)="previousStep()">&lt; Previous</button>
            </div>
        </div>

        <div *ngIf="formData.selectedType ===  'DataClass'">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div style="margin-bottom: 10px;">
                    Please select a {{formData.selectedType}} ?
                </div>

                <input type="text"
                       class="form-control input-sm"
                       [(ngModel)]="formData.treeSearchText"
                       placeholder="Search"
                       (input)="searchInTree('DataClass')"
                       [ngModelOptions]="{ debounce: 500 }">

                <div style="width: 100%; height: 300px;overflow-y: auto;border: 1px solid #DDD;">
                    <div>
                       <mdm-folders-tree
                            [inSearchMode]="formData.inSearchMode"
                            [doNotMakeSelectedBold]="true"
                            [expandOnNodeClickFor]="['Folder', 'DataModel', 'DataClass']"
                            [searchCriteria]="formData.treeSearchText"
                            (nodeClickEvent)="onNodeInTreeSelect($event)"
                            [node]="rootNode"></mdm-folders-tree>
                    </div>
                </div>
                <div style="margin-top: 10px;" *ngIf="showPrevBtn">
                    <button class="btn btn-default btn-xs modelSelectorDialogueBtn" (click)="previousStep()">&lt; Previous</button>
                </div>
            </div>
        </div>

        <div *ngIf="formData.selectedType == 'Folder'">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div style="margin-bottom: 10px;margin-left: 5px;">
                    Please select a Folder:
                </div>

                <div style="width: 100%; height: 300px;overflow-y: auto; border: 1px solid #DDD;">
                    <div>
                       <mdm-folders-tree
                            [doNotMakeSelectedBold]="true"
                            [justShowFolders]="true"
                            [doNotShowDataClasses]="true"
                            (nodeClickEvent)="onNodeInTreeSelect($event)"
                            [node]="rootNode"></mdm-folders-tree>
                    </div>
                </div>
                <div style="margin-top: 10px;" *ngIf="showPrevBtn">
                    <button class="btn btn-default btn-xs modelSelectorDialogueBtn" (click)="previousStep()">&lt; Previous</button>
                </div>
            </div>

        </div>


        <div *ngIf="formData.selectedType === 'Term'">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div>
                    Please select a Term:
                </div>
                <div style="padding-bottom:1.2em">
                    <mdm-select [width]="'100%'"
                               [acceptTypedInput]="false"
                               [valueType]="'static'"
                               [staticValues]="terminologies"
                               [minInputLength]="1"
                               [hasError]="false"
                               [idProperty]="'id'"
                               [displayProperty]="'label'"
                               [searchProperty]="'label'"
                               (selectEvent)="onTerminologySelect($event[0],$event[1])">
                        <ng-template #lineContent let-item>
                            <div>{{item.label}}</div>
                        </ng-template>
                    </mdm-select>
                </div>
                <div>
                    <input type="text" id="searchInput" class="form-control input-sm ng-pristine ng-valid ng-touched" autocomplete="off" [(ngModel)]="searchInput" #searchInputControl [ngModelOptions]="{ debounce: 500 }" placeholder="Search for Terms..." [disabled]="noData" aria-invalid="false">
                </div>
                <div style="height: 240px">
                    <mat-table #table [dataSource]="dataSource" (scroll)="onTableScroll($event)" style="max-height: 100%; overflow: auto;">

                        <!-- Position Column -->
                        <ng-container matColumnDef="label">
                            <mat-header-row *matHeaderCellDef> Term </mat-header-row>
                            <mat-cell style="max-width: 50%; width: 50%; text-align: left; word-wrap: break-word; padding-right: 5px; padding-left: 5px" mat-cell *matCellDef="let element">
                                <!--                                <a target="_blank" style="width:100%" href=null>{{element.label}}</a>-->
                                <mdm-element-link [showTypeTitle]="true"
                                              [newWindow]= "true"
                                              [parentDataModel]="{id:element.dataModel}"
                                              [parentDataClass]="{id:element.dataClass}"
                                              [showHref]="false"
                                              [element]="element"></mdm-element-link>

                            </mat-cell>
                        </ng-container>

                        <mat-row class="mat-table-row-select" (click)="onTermSelect(row)" *matRowDef="let row; columns: displayedColumns;"></mat-row>
                    </mat-table>
                </div>
                <div *ngIf="totalItemCount > 0" style="float: right;">
                        <span *ngIf="loading">
                            <i class="fas fa-sync-alt fa-spin"></i>
                        </span>
                    <span style="font-size: 11px; font-style: italic;">
                            {{currentRecord}} / {{totalItemCount}}
                        </span>
                </div>
                <div style="margin-top: 10px;" *ngIf="showPrevBtn">
                    <button class="btn btn-default btn-xs modelSelectorDialogueBtn" (click)="previousStep()">&lt; Previous</button>
                </div>
<!--                <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">-->
<!--                    <div style="margin-top: 10px;" *ngIf="showPrevBtn" class="col-xs-6 col-sm-6 col-md-6 col-lg-6">-->
<!--                        <button class="btn btn-default btn-xs modelSelectorDialogueBtn" (click)="previousStep()">&lt; Previous</button>-->
<!--                    </div>-->
<!--                    <div style="margin-top: 10px; float: right; text-align: right" class="col-xs-6 col-sm-6 col-md-6 col-lg-6">-->
<!--                        <span> {{currentRecord}} / {{totalItemCount}}</span>-->
<!--                    </div>-->
<!--                </div>-->
            </div>
        </div>
        <div *ngIf="formData.selectedType ===  'DataElement'" style="background-color: #FFF;">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div style="margin-bottom: 10px;margin-left: 5px;">
                    Please select a {{formData.selectedType}} ?
                </div>
                <div style="margin-top: 10px;">
                    <input type="text" id="dataElementsearchInput"
                           class="form-control input-sm ng-pristine ng-valid ng-touched"
                           autocomplete="off"
                           [(ngModel)]="searchInput"
                           (ngModelChange)="searchTextChanged()"
                           [ngModelOptions]="{ debounce: 500 }"
                           [placeholder]="( (formData.currentContext)? ('Search within ' + formData.currentContext.label) : 'Search...' )">



                    <!--          <input type="text"-->
                    <!--                 class="form-control input-sm"-->
                    <!--                 ng-model="formData.treeSearchText"-->
                    <!--                 placeholder="{{ ( (formData.currentContext)? ('Search within ' + formData.currentContext.label) : 'Search...' )}}"-->
                    <!--                 ng-change="runContextSearch()"-->
                    <!--                 ng-model-options='{ debounce: 500 }'>-->
                </div>

                <div style="margin-top: 5px;">
                    <div style="margin-left: 5px;">Restrict your search to a context (optional):</div>
                    <div style="margin-top: 2px;">
                          <mdm-model-selector-tree
                                [onSelect]="onContextSelected"
                                [placeholder]="'Choose a Folder or Data Model or Data Class'"
                                [accepts]="['Folder', 'DataModel', 'DataClass']"
                                [usedInModalDialogue]="true">
                        </mdm-model-selector-tree>
                    </div>
                </div>



                <div style="height: 240px">
                    <mat-table [dataSource]="dataSource" (scroll)="onTableScroll($event)" style="max-height: 100%; overflow: auto;">

                        <!--- Note that these columns can be defined in any order.
                        The actual rendered columns are set as a property on the row definition" -->
                        <!-- Position Column -->
                        <ng-container matColumnDef="label">
                            <mat-header-cell *matHeaderCellDef></mat-header-cell>
                            <mat-cell style="max-width: 100%; width: 90%; text-align: left;" *matCellDef="let element"> {{element.label}} </mat-cell>
                        </ng-container>


                        <!-- Expanded Content Column - The detail row is made up of this one column -->
                        <ng-container matColumnDef="expandedDetail">
                            <mat-cell  *matCellDef = "let record">

                                <mdm-model-path [path]="record.element.breadcrumbs" [showHref]="false" [newWindow]="true" ></mdm-model-path>

                            </mat-cell>
                        </ng-container>


                        <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
                        <mat-row *matRowDef="let row; columns: displayedColumns;"
                                 matRipple
                                 class="element-row mat-table-row-select"
                                 [class.expanded]="expandedElement == row"
                                 (mouseover)="expandedElement = row"
                                 (click)="onTermSelect(row.element)"></mat-row>
                        <mat-row class="mat-table-row-select" (click)="onTermSelect(row.element)" *matRowDef="let row; columns: ['expandedDetail']; when: isExpansionDetailRow"
                                 [@detailExpand]="row.element == expandedElement ? 'expanded' : 'collapsed'"
                                 style="overflow: hidden">
                        </mat-row>
                    </mat-table>
                </div>

                                    <div *ngIf="totalItemCount > 0" style="float: right;">
                                        <span *ngIf="loading">
                                            <i class="fas fa-sync-alt fa-spin"></i>
                                        </span>
                                        <span style="font-size: 11px; font-style: italic;">
                                            {{currentRecord}} / {{totalItemCount}}
                                        </span>
                                    </div>
                <div style="margin-top: 10px;" ng-if="showPrevBtn">
                    <button class="btn btn-default btn-xs modelSelectorDialogueBtn" (click)="previousStep()">&lt; Previous</button>
                </div>
<!--                <div style="margin-top: 10px; float: right; text-align: right" class="col-xs-6 col-sm-6 col-md-6 col-lg-6">-->
<!--                    <span> {{currentRecord}} / {{totalItemCount}}</span>-->
<!--                </div>-->

            </div>
        </div>

        <div *ngIf="formData.selectedType ===  'DataType'" style="background-color: #FFF;">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div style="margin-left: 5px;">
                    Please select a DataType ?
                </div>
                <div style="margin-top: 10px;">
<!--                    <input type="text"-->
<!--                           class="form-control input-sm"-->
<!--                           ng-model="formData.treeSearchText"-->
<!--                           placeholder="{{ ( (formData.currentContext)? ('Search within ' + formData.currentContext.label) : 'Search...' )}}"-->
<!--                           ng-change="runContextSearch()"-->
<!--                           ng-model-options='{ debounce: 500 }'>-->
                    <input type="text" id="dataTypesearchInput"
                           class="form-control input-sm ng-pristine ng-valid ng-touched"
                           autocomplete="off"
                           [(ngModel)]="searchInput"
                           (ngModelChange)="searchTextChanged()"
                           [ngModelOptions]="{ debounce: 500 }"
                           placeholder="{{ ( (formData.currentContext)? ('Search within ' + formData.currentContext.label) : 'Search...' )}}">
                </div>

                <div style="margin-top: 5px;">
                    <div style="margin-left: 5px;">Restrict your search to a context (optional):</div>
                    <div style="margin-top: 2px;">
                        <mdm-model-selector-tree
                                [onSelect]="onContextSelected"
                                [placeholder] ="'Choose a Folder or Data Model'"
                                [doNotShowDataClasses]="true"
                                [accepts]="['Folder', 'DataModel']"
                                [usedInModalDialogue]="true">
                        </mdm-model-selector-tree>
                    </div>
                </div>
                <div style="height: 240px">
                    <mat-table [dataSource]="dataSource" (scroll)="onTableScroll($event)" style="max-height: 100%; overflow: auto;">

                        <!--- Note that these columns can be defined in any order.
                        The actual rendered columns are set as a property on the row definition" -->
                        <!-- Position Column -->
                        <ng-container matColumnDef="label">
                            <mat-header-cell *matHeaderCellDef></mat-header-cell>
                            <mat-cell style="max-width: 100%; width: 90%; text-align: left;" *matCellDef="let element"> {{element.label}} </mat-cell>
                        </ng-container>


                        <!-- Expanded Content Column - The detail row is made up of this one column -->
                        <ng-container matColumnDef="expandedDetail">
                            <mat-cell  *matCellDef = "let record">

                                <mdm-model-path [path]="record.element.breadcrumbs" [showHref]="false" [newWindow]="true" ></mdm-model-path>

                            </mat-cell>
                        </ng-container>


                        <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
                        <mat-row *matRowDef="let row; columns: displayedColumns;"
                                 matRipple
                                 class="element-row mat-table-row-select"
                                 [class.expanded]="expandedElement == row"
                                 (mouseover)="expandedElement = row"
                                 (click)="onTermSelect(row.element)"></mat-row>
                        <mat-row class="mat-table-row-select" (click)="onTermSelect(row.element)" *matRowDef="let row; columns: ['expandedDetail']; when: isExpansionDetailRow"
                                 [@detailExpand]="row.element == expandedElement ? 'expanded' : 'collapsed'"
                                 style="overflow: hidden">
                        </mat-row>
                    </mat-table>
                </div>




                <div *ngIf="totalItemCount > 0" style="float: right;">
                        <span *ngIf="loading">
                            <i class="fas fa-sync-alt fa-spin"></i>
                        </span>
                    <span style="font-size: 11px; font-style: italic;">
                            {{currentRecord}} / {{totalItemCount}}
                        </span>
                </div>
                <div style="margin-top: 10px;" *ngIf="showPrevBtn">
                    <button class="btn btn-default btn-xs modelSelectorDialogueBtn" (click)="previousStep()">&lt; Previous</button>
                </div>
            </div>
        </div>
    </div>

</mat-dialog-content>

