<!--
Copyright 2020 University of Oxford

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.

SPDX-License-Identifier: Apache-2.0
-->
<div class="mdm--shadow-block">
    <div class="heading-container">
        <h4 [ngPlural]="totalItemCount" class="marginless">
            <ng-template ngPluralCase="=1">
                There is <span class="mdm--badge mdm--element-count">1</span> user in this repository waiting for your approval.
            </ng-template>
            <ng-template ngPluralCase="other">
                There are <span class="mdm--badge mdm--element-count">{{ totalItemCount }}</span> users in this repository waiting for your approval.
            </ng-template>
        </h4>
        <i class="fas fa-filter" (click)="filterClick()" style="cursor: pointer;margin-left: 2px;"></i>
    </div>

    <div class="table-responsive">
        <table mat-table [dataSource]="records" matSort class="table mdm--table mdm--table-responsive table-striped">
            <ng-container matColumnDef="firstName">
                <th mat-header-cell *matHeaderCellDef mat-sort-header="firstName" [disabled]="!hideFilters" style="cursor: pointer;" columnName="firstName">
                    <span [hidden]="!hideFilters">First Name</span>
                    <div [hidden]="hideFilters">
                        <mat-form-field class="filter" floatLabel="never">
                            <mat-label>First Name</mat-label>
                            <input #filters matInput name="firstName" (keyup)="applyFilter()">
                        </mat-form-field>
                    </div>
                </th>
                <td mat-cell *matCellDef="let record" style="text-align: left; word-wrap: break-word;">
                    <div class="mdm--td-cell">First name</div>
                    <span>{{ record.firstName }}</span>
                </td>
            </ng-container>
            <ng-container matColumnDef="lastName">
                <th mat-header-cell *matHeaderCellDef mat-sort-header="lastName" [disabled]="!hideFilters" style="cursor: pointer;" columnName="lastName">
                    <span [hidden]="!hideFilters">Last Name</span>
                    <div [hidden]="hideFilters">
                        <mat-form-field class="filter" floatLabel="never">
                            <mat-label>Last Name</mat-label>
                            <input #filters matInput name="lastName" (keyup)="applyFilter()" />
                        </mat-form-field>
                    </div>
                </th>
                <td mat-cell *matCellDef="let record" style="text-align: left; word-wrap: break-word;">
                    <div class="mdm--td-cell">Last name</div>
                    <span>{{ record.lastName }}</span>
                </td>
            </ng-container>
            <ng-container matColumnDef="emailAddress">
                <th mat-header-cell *matHeaderCellDef mat-sort-header="emailAddress" [disabled]="!hideFilters" style="cursor: pointer;" columnName="emailAddress">
                    <span [hidden]="!hideFilters">Email</span>
                    <div [hidden]="hideFilters">
                        <mat-form-field class="filter" floatLabel="never">
                            <mat-label>To</mat-label>
                            <input #filters matInput name="emailAddress" (keyup)="applyFilter()" />
                        </mat-form-field>
                    </div>
                </th>
                <td mat-cell *matCellDef="let record" style="text-align: left; word-wrap: break-word;">
                    <div class="mdm--td-cell">Email</div>
                    <span>{{ record.emailAddress }}</span>
                </td>
            </ng-container>
            <ng-container matColumnDef="organisation">
                <th mat-header-cell *matHeaderCellDef mat-sort-header="organisation" [disabled]="!hideFilters" style="cursor: pointer;" columnName="organisation">
                    <span [hidden]="!hideFilters">Organisation</span>
                    <div [hidden]="hideFilters">
                        <mat-form-field class="filter" floatLabel="never">
                            <mat-label>Organisation</mat-label>
                            <input #filters matInput name="organisation" (keyup)="applyFilter()">
                        </mat-form-field>
                    </div>
                </th>
                <td mat-cell *matCellDef="let record" style="text-align: left; word-wrap: break-word;">
                    <div class="mdm--td-cell">Organisation</div>
                    <span>{{ record.organisation }}</span>
                </td>
            </ng-container>
            <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef style="cursor: pointer;" columnName="actions">
                    <span [hidden]="!hideFilters"></span>
                </th>
                <td mat-cell *matCellDef="let record; let i = index" style="text-align: right;">
                    <button mat-stroked-button color="primary" [matMenuTriggerFor]="actions">Actions <i class="fas fa-chevron-down fa-xs"></i></button>
                    <mat-menu #actions="matMenu" yPosition="below" xPosition="after">
                        <button mat-menu-item color="accent" type="button" (click)="askForSoftApproval(record)">
                            <i class="fas fa-check"></i> Approve user
                        </button>
                        <button mat-menu-item color="warn" type="button" (click)="askForSoftRejection(record)">
                            <i class="fa fa-ban warning"></i> Reject user
                        </button>
                    </mat-menu>
                </td>
            </ng-container>
            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let record; columns: displayedColumns"></tr>
        </table>

        <div class="mdm--mat-pagination">
            <mdm-paginator [pageSizeOptions]="[5, 10, 20, 50]" [pageSize]="20" [length]="totalItemCount" showFirstLastButtons></mdm-paginator>
        </div>
    </div>
    <div *ngIf="!totalItemCount" class="pxy-2 bordered">
        <p class="mt-2">There are no pending users in this repository.</p>
    </div>
</div>
