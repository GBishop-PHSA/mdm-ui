<!--
Copyright 2020 University of Oxford

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.

SPDX-License-Identifier: Apache-2.0
-->
<div class="panel panel-default mdm--shadow-block">
    <form name="form" onaftersave="onAfterSave()" (ngSubmit)="formBeforeSave()" disable-submit-on-enter>
        <div class="panel-body">
            <div *ngIf="result">
                <div [ngClass]="{ 'has-error': errorMessage != ''}">
                    <h4 class="inline-block marginless">
                        <mdm-inline-text-edit [inEditMode]="editableForm.visible" [(ngModel)]="editableForm.label"
                            [styleCss]="'dataModelDetailsLabel'" name="moduleName" size="20"></mdm-inline-text-edit>
                    </h4>
                </div>
                <div [ngClass]="{'form-group':true, 'has-error': true }" *ngIf="errorMessage != ''">
                    <span class="help-block">{{errorMessage}}</span>
                </div>
            </div>

            <div class="detail-icons">
                <div class="text-muted">
                  <small>
                      <i class="fas fa-cube" matTooltip="Item type"></i>
                      <span><strong>Item type: </strong><span class="item-type">Data Class</span></span>
                  </small>
                </div>
                <div class="text-muted" *ngIf="result">
                    <small>
                        <i class="far fa-calendar-alt" matTooltip="Last update"></i>
                        <span><strong>Last update: </strong>{{ result.lastUpdated | date:"yyyy-MM-dd HH:mm:ss" }}</span>
                    </small>
                </div>
                <div class="text-muted" *ngIf="result && result.finalised && result.dateFinalised">
                    <small>
                        <i class="far fa-calendar-check" matTooltip="Finalised on"></i>
                        <span><strong>Finalised on:</strong>{{result.dateFinalised | date:"yyyy-MM-dd HH:mm:ss" }}</span>
                    </small>
                </div>
            </div>
        </div>
        <table class="table table-bordered mdm--table-fixed">
            <tbody>
                <tr>
                    <td class="detailsRowHeader">Aliases</td>
                    <td>
                        <mdm-element-alias [inEditMode]="editableForm.visible" [aliases]="aliases" [element]="result"
                            [editableForm]="editableForm" [property]="'aliases'"></mdm-element-alias>
                    </td>
                </tr>
                <tr>
                    <td class="detailsRowHeader">Description</td>
                    <td class="elementDetailDescription">
                        <div *ngIf="result">
                            <mdm-markdown-text-area [editableForm]="editableForm" [element]="result" [property]="'description'"></mdm-markdown-text-area>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td class="detailsRowHeader">Parent Hierarchy</td>
                    <td *ngIf="result">
                        <mdm-model-path [path]="result.breadcrumbs"></mdm-model-path>
                    </td>
                </tr>
                <tr>
                    <th class="detailsRowHeader">Multiplicity</th>
                    <td class="dataClassDetailsModelPath">

                        <div *ngIf="!editableForm.visible && result">
                            <mdm-multiplicity [min]="result.minMultiplicity" [max]="result.maxMultiplicity">
                            </mdm-multiplicity>
                        </div>
                        <div *ngIf="result">
                            <small *ngIf="editableForm.visible" class="block">
                                Please enter <strong>*</strong> for unbound multiplicity.
                            </small>
                            <div style="float: left;">
                                <div *ngIf="editableForm.visible">
                                    Min
                                    <mdm-inline-text-edit [inEditMode]="editableForm.visible"
                                                          [(ngModel)]="min"
                                                          [styleCss]="'dataModelDetailsLabel'"
                                                          name="moduleNameMinText" size="20"
                                                          size="5">
                                    </mdm-inline-text-edit>
                                </div>
                                <span *ngIf="!editableForm.visible && (result.minMultiplicity && result.minMultiplicity == 0)">..</span>
                                <span *ngIf="editableForm.visible" style="padding-right: 10px"></span>
                            </div>

                            <div style="float: left;margin-right: 13px;">
                                <div *ngIf="editableForm.visible" style="padding-left: 6px">
                                    Max
                                    <mdm-inline-text-edit [inEditMode]="editableForm.visible"
                                                          [(ngModel)]="max"
                                                          [styleCss]="'dataModelDetailsLabel'"
                                                          name="moduleNameMaxText" size="20"
                                                          size="5">
                                    </mdm-inline-text-edit>
                                </div>
                            </div>
                            <div style="clear: both;" [ngClass]="{'has-error': true }" *ngIf="error != ''">
                                <small class="warning">{{error}}</small>
                            </div>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td class="detailsRowHeader">Classifications</td>
                    <td *ngIf="result">
                        <mdm-element-classifications [classifications]="result.classifiers"
                            [editableForm]="editableForm" [element]="result" [property]="'classifiers'">
                        </mdm-element-classifications>

                    </td>
                </tr>
                <tr>
                    <td colspan="2" style="text-align: right;">
                        <div *ngIf="result" mdmShowIfRolesWritable [result]="result"
                            style="float: right;margin-bottom: 3px">
                            <div style="float: right">
                                <mdm-editable-form-buttons [hidden]="editableForm.visible" [onCancelEdit]="onCancelEdit"
                                    [editable]="editableForm" [textLocation]="'left'" [hideDelete]="false"
                                    [hideCancel]="false" [hideEdit]="true" (delete)="delete()"
                                    [processing]="deleteInProgress"></mdm-editable-form-buttons>
                            </div>
                            <div *ngIf="result.editable" [hidden]="editableForm.visible || editableForm.deletePending" style="position: relative; float: right; margin-right:4px;">
                                <button mat-stroked-button color="primary" type="button" [disabled]="deleteInProgress" matTooltip="Edit" aria-label="Edit" (click)="showForm();">
                                    <i class="fas fa-pencil-alt"></i>
                                </button>
                            </div>
                            <mdm-editable-form-buttons [hidden]="!editableForm.visible"
                                                        [onCancelEdit]="onCancelEdit"
                                                        [editable]="editableForm"
                                                        [textLocation]="'left'"
                                                        [hideDelete]="true"
                                                        [hideCancel]="false"
                                                        [processing]="deleteInProgress">
                            </mdm-editable-form-buttons>
                        </div>

                        <!-- TODO - DB migration -->
                        <!-- <div style="position: relative; float: right; margin-right:4px;"
                            [hidden]="editableForm.visible || editableForm.deletePending">
                            <button mat-stroked-button color="primary" type="button" class="paddingless"
                                matTooltipPosition="below" matTooltip="Search" aria-label="Search"
                                [disabled]="processing" (click)="toggleShowSearch()">
                                <i class="fas fa-search"></i>
                            </button>
                        </div> -->

                        <div style="clear: both;" *ngIf="processing">
                            <mat-progress-bar value="50" bufferValue="75" color="accent" mode="indeterminate"></mat-progress-bar>
                        </div>
                        <div style="text-align: left" *ngIf="exportError">
                            <div style="padding-top: 25px;">
                                <div class="alert alert-danger">
                                    <strong>Error!</strong> {{exportError}}
                                </div>
                            </div>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>

    </form>
</div>
