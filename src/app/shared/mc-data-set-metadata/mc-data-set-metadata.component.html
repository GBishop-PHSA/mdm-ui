<div class="mcTableMain">
    <div class="mcTableTitle">
        <span class="title">Properties <span class="badge element-count ng-binding" style="margin: 0px 3px; display: inline;" aria-hidden="false">{{totalItemCount}}</span> <i class="fas fa-filter" (click)="filterClick()" style="cursor: pointer;margin-left: 2px;"></i> </span>

        <div *ngIf="access && access.canAddMetadata" class="btn-group-xs" style="float: right; margin-top: -2px; margin-left: 9px;">
            <i id="helpIcon1" class="fas fa-info-circle helpIcon" style="font-size: 14px;" (click)="loadHelp($event)" matTooltipPosition="left" matTooltip="Help"></i>
            <button type="button" matTooltip="Add Property" class="btn btn-xs btn-default addNewModelButton" (click)="add()">
                <i class="fas fa-plus" aria-hidden="true"></i>
            </button>
        </div>
    </div>

    <div class="mcTableContainer">
        <table mat-table matSort [dataSource]="records" class="table table-condensed table-bordered mcTable" [hidden]="isLoadingResults">
            <ng-container matColumnDef="namespace">
                <th mat-header-cell *matHeaderCellDef mat-sort-header [disabled]="!hideFilters" style="cursor:pointer;max-width: 40%;width: 40%;">
                    <span [hidden]="!hideFilters">Namespace</span>
                    <div [hidden]="hideFilters">
                        <mat-form-field class="filter" floatLabel="never">
                            <mat-label>Namespace</mat-label>
                            <input #filters matInput name="namespace" (keyup)="applyFilter()">
                        </mat-form-field>
                    </div>
                </th>
                <td mat-cell *matCellDef="let rec; let i = index" style="max-width: 40%;width: 40%;text-align: left;word-wrap: break-word;">
                    <div *ngIf="!rec.inEdit">
                        {{rec.namespace}}
                    </div>
                    <div *ngIf="rec.inEdit">
                        <mc-select [width]="'100%'"
                                   [accept-typed-input]="true"
                                   [value-type]="'static'"
                                   [static-values]="namespaces"
                                   [default-value]="rec.namespace"
                                   [has-error]="rec.edit.errors && rec.edit.errors['namespace']"
                                   [(record)]="records[rec]"
                                   [min-input-length]="0"
                                   [id-property]="'id'"
                                   [display-property]="'namespace'"
                                   [search-property]="'namespace'"
                                   (on-select)="onNamespaceSelect($event[0],$event[1])"
                                   name="test">
                            <ng-template #lineContent let-item>
                                <div>{{item.namespace}}</div>
                            </ng-template>
                        </mc-select>
                        <small *ngIf="rec.edit.errors && rec.edit.errors['namespace']" class="errorMessage">{{rec.edit.errors['namespace']}}</small>
                    </div>
                </td>
            </ng-container>
            <ng-container matColumnDef="key">
                <th mat-header-cell mat-sort-header *matHeaderCellDef [disabled]="!hideFilters" style="cursor:pointer;max-width: 20%;width: 20%;">
                    <span [hidden]="!hideFilters">Key</span>
                    <div [hidden]="hideFilters">
                        <mat-form-field class="filter" floatLabel="never">
                            <mat-label>Key</mat-label>
                            <input #filters matInput name="key" (keyup)="applyFilter()">
                        </mat-form-field>
                    </div>
                </th>
                <td mat-cell *matCellDef="let record" style="max-width: 20%;width: 20%;text-align: left;word-wrap: break-word;">
                    <div *ngIf="!record.inEdit">
                        {{record.key}}
                    </div>
                    <div *ngIf="record.inEdit">
                        <mc-select [width]="'100%'"
                                   [accept-typed-input]="true"
                                   [value-type]="'static'"
                                   [static-values]="record.metadataKeys"
                                   [default-value]="record.key"
                                   [has-error]="record.edit.errors && record.edit.errors['key']"
                                   [(record)]="records[record]"
                                   [min-input-length]="0"
                                   [id-property]="'id'"
                                   [display-property]="'key'"
                                   [search-property]="'key'"
                                   (on-select)="onKeySelect($event[0],$event[1])">
                            <ng-template #lineContent let-item>
                                <div>{{item.key}}</div>
                            </ng-template>
                        </mc-select>

                        <small *ngIf="record.edit.errors && record.edit.errors['key']" class="errorMessage">{{record.edit.errors['key']}}</small>

                    </div>
                </td>
            </ng-container>
            <ng-container matColumnDef="value">
                <th mat-header-cell *matHeaderCellDef mat-sort-header [disabled]="!hideFilters" style="cursor:pointer;max-width: 30%;width: 30%;">
                    <span [hidden]="!hideFilters">Value</span>
                    <div [hidden]="hideFilters">
                        <mat-form-field class="filter" floatLabel="never">
                            <mat-label>Value</mat-label>
                            <input #filters matInput name="value" (keyup)="applyFilter()">
                        </mat-form-field>
                    </div>
                </th>
                <td mat-cell *matCellDef="let record" style="max-width: 30%;width: 30%;text-align: left;word-wrap: break-word;">
                    <div *ngIf="!record.inEdit">
                        <more-description [description]="record.value" [length]="100"></more-description>
                    </div>
                    <div *ngIf="record.inEdit">
                        <div class="form-group" [ngClass]="{'has-error':record.edit.errors && record.edit.errors['value']}">


                            <markdown-text-area rows="'4'" [(description)]="record.edit.value" [in-edit-mode]="true" [hide-help-text]="true"></markdown-text-area>

                            <small *ngIf="record.edit.errors && record.edit.errors['value']" class="errorMessage">{{record.edit.errors['value']}}</small>
                        </div>
                    </div>
                </td>
            </ng-container>
            <ng-container matColumnDef="btns" style="max-width: 75px; width: 75px;">
                <th mat-header-cell *matHeaderCellDef></th>
                <td mat-cell *matCellDef="let record;  let i = index" style="max-width: 8%;width: 8%;text-align: center;word-wrap: break-word;">
                    <div ng-if="access && access.canAddMetadata">
                        <table-buttons [record]="record" [index]="i" (save)="save($event[0],$event[1])" (delete)="delete($event[0],$event[1])" [validate]="validate" (cancel-edit)="cancelEdit($event[0],$event[1])" (on-edit)="onEdit($event[0],$event[1])" ></table-buttons>
                    </div>
                </td>
            </ng-container>


            <tr mat-header-row *matHeaderRowDef="displayedColumns" style="height: auto;" class="mcTableHeader"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;" style="height: auto"></tr>

        </table>
    </div>
    
    <mat-card *ngIf="isLoadingResults" 
              style="display: flex; justify-content: center; align-items: center">
        <mat-progress-spinner 
            color="primary" 
            mode="indeterminate">
        </mat-progress-spinner>
    </mat-card>

    <div class="d-flex justify-content-between p-2">
        <mat-paginator [pageSizeOptions]="[5, 10, 20,50]" [pageSize]="20" [length]="totalItemCount" showFirstLastButtons></mat-paginator>
    </div>
</div>