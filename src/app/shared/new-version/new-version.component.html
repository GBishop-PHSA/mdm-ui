<!--
Copyright 2020-2021 University of Oxford
and Health and Social Care Information Centre, also known as NHS Digital

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.

SPDX-License-Identifier: Apache-2.0
-->
<div *ngIf="catalogueItem" class="mdm-new-version">
  <div class="mdm--shadow-block">
    <div class="panel">
      <div class="panel-heading">
        <div class="heading-container">
          <h4>New version of "{{ catalogueItem.label }}"</h4>
        </div>

        <div class="panel-body">
          <div class="mb-2 mt-2">
            <p>
              A new version of <b>{{ catalogueItem.label }}</b> keeps all of the
              following:
            </p>
            <ul>
              <li *ngIf="domainType === 'VersionedFolder'">Models</li>
              <li *ngIf="domainType === 'VersionedFolder'">Folders</li>
              <li>Classes</li>
              <li>Types</li>
              <li>Elements</li>
              <li>Properties</li>
            </ul>
          </div>
          <div class="mb-2">
            <div class="mb-2">
              <h4 class="mat-h4 marginless">
                Select the type of the new version that you want to create:
              </h4>

              <div class="mt-2">
                <mat-form-field appearance="outline">
                  <mat-label>Type</mat-label>
                  <mat-select [(ngModel)]="versionType" [disabled]="processing">
                    <mat-option class="mdm-new-version__type" [value]="'Fork'">
                      <i class="fas fa-list"></i> New Fork
                    </mat-option>
                    <mat-option
                      class="mdm-new-version__type"
                      [value]="'Version'"
                    >
                      <i class="fas fa-file-alt"></i> New Version
                    </mat-option>
                    <mat-option
                      class="mdm-new-version__type"
                      [value]="'Branch'"
                    >
                      <i class="fas fa-code-branch"></i> New Branch
                    </mat-option>
                  </mat-select>
                </mat-form-field>
              </div>

              <mdm-alert
                alertStyle="info"
                [showIcon]="true"
                *ngIf="versionType === 'Fork'"
              >
                <p>
                  This will create a copy of
                  <b>{{ catalogueItem.label }}</b> with a new name, and a new
                  'main' branch.
                </p>
                <p>
                  Use this option if you are planning on taking this
                  {{ domainType === 'VersionedFolder' ? 'folder' : 'model' }} in
                  a new direction, or under a new authority.
                </p>
              </mdm-alert>

              <mdm-alert
                alertStyle="info"
                [showIcon]="true"
                *ngIf="versionType === 'Version'"
              >
                <p>
                  This will create a draft copy of
                  <b>{{ catalogueItem.label }}</b> under the 'main' branch.
                </p>
                <p>
                  Use this option if you want to create the next iteration of
                  this
                  {{ domainType === 'VersionedFolder' ? 'folder' : 'model' }}.
                </p>
              </mdm-alert>

              <mdm-alert
                alertStyle="info"
                [showIcon]="true"
                *ngIf="versionType === 'Branch'"
              >
                <p>
                  This will create a copy of <b>{{ catalogueItem.label }}</b> in
                  a new branch. You may choose the name of the new branch.
                </p>
                <p>
                  Use this option if you want to make some changes that you
                  subsequently wish to merge back into 'main'.
                </p>
              </mdm-alert>

              <div *ngIf="versionType === 'Fork'">
                <div class="mdm--form-input mb-2">
                  <h4 class="mat-h4 marginless">Additional details:</h4>

                  <div
                    [ngClass]="{
                      'form-group': true,
                      'has-error': errors && errors.label
                    }"
                  >
                    <mat-form-field appearance="outline" class="full-width">
                      <mat-label>Model name</mat-label>
                      <input
                        matInput
                        [(ngModel)]="form.label"
                        [disabled]="processing"
                        required
                      />
                      <mat-hint
                        >The name should be different from the current version
                        name '{{ catalogueItem.label }}'</mat-hint
                      >
                    </mat-form-field>
                    <span
                      class="help-block warning"
                      *ngIf="errors && errors.label"
                      style="margin-left: 16px"
                      ><small>{{ errors.label }}</small></span
                    >
                  </div>
                </div>
              </div>

              <div *ngIf="versionType === 'Branch'">
                <div
                  [ngClass]="{
                    'form-group': true,
                    'has-error': errors && errors.label
                  }"
                >
                  <mat-form-field appearance="outline" class="full-width">
                    <mat-label>Branch name</mat-label>
                    <input
                      matInput
                      [(ngModel)]="form.label"
                      [disabled]="processing"
                      required
                    />
                  </mat-form-field>
                  <span
                    class="help-block warning"
                    *ngIf="errors && errors.label"
                    style="margin-left: 16px"
                    ><small>{{ errors.label }}</small></span
                  >
                </div>
              </div>
              <div *ngIf="step > 1">
                <button
                  mat-button
                  color="warn"
                  (click)="cancel()"
                  [disabled]="processing"
                >
                  Cancel
                </button>
                <button
                  mat-flat-button
                  color="primary"
                  class="custom"
                  (click)="save()"
                  [disabled]="processing"
                >
                  Add {{ versionType }}
                </button>

                <div style="margin-top: 5px" *ngIf="processing">
                  <mat-progress-bar
                    value="50"
                    bufferValue="75"
                    color="accent"
                    mode="indeterminate"
                  ></mat-progress-bar>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
