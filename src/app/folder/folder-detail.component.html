<div class="panel panel-default mdm--shadow-block">
    <form editable-form name="form" onaftersave="onAfterSave()" (ngSubmit)="formBeforeSave()" disable-submit-on-enter>
        <div class="panel-body">
            <div *ngIf="result">
                <div [ngClass]="{ 'has-error': errorMessage != ''}">
                    <h4 class="inline-block marginless" [ngClass]="{'deletedDataModelTitle': result?.deleted}">
                        <span class="dataModelTypeIcon">
                            <i matTooltip="Data Standard" class="fas fa-folder"></i>
                        </span>
                        <mdm-inline-text-edit  [inEditMode]="editableForm.visible" [(ngModel)]="editableForm.label" [name]="'moduleName'" size="20" (input)="onLabelChange($event.target.value)" [styleCss]="'dataModelDetailsLabel'"></mdm-inline-text-edit>
                    </h4>
                    <span class="inline-block">
                        <small *ngIf="result?.deleted" class="warning"> | Deleted</small>
                    </span>
                </div>
                <div [ngClass]="{'form-group':true, 'has-error': true }" *ngIf="errorMessage != ''">
                    <span class="help-block">{{errorMessage}}</span>
                </div>
            </div>

            <div class="detail-icons">
                <div class="text-muted" *ngIf="result?.readableByEveryone">
                    <small>
                        <i class="fas fa-globe-europe globe" aria-hidden="true" title="Publicly Readable"></i>
                        <span><strong>Availability: </strong>Publicly Readable</span>
                    </small>
                </div>
            </div>
        </div>

        <table class="table dataModelDetailTable">
            <tbody>
                <tr>
                    <td class="detailsRowHeader">Description</td>
                    <td class="elementDetailDescription">
                        <div *ngIf="hasResult">
                            <mdm-markdown-text-area [editableForm]="editableForm" [element]="result" [property]="'description'"></mdm-markdown-text-area>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td colspan="2" style="text-align: right;">
                        <div style="float: right;margin-bottom: 3px;margin-left: 5px;" [hidden]="editableForm.visible || editableForm.deletePending" *ngIf="showDelete">
                            <div style="float: right;margin-bottom: 3px;margin-left: 5px;" [hidden]="editableForm.visible || editableForm.deletePending" *ngIf="showDelete">
                                <button mat-stroked-button
                                        color="warn"
                                        type="button"
                                        matTooltip="Delete"
                                        aria-label="Delete"
                                        class="paddingless dropdown-toggle"
                                        [disabled]="deleteInProgress || exporting"
                                        [matMenuTriggerFor]="menu">
                                        <i class="far fa-trash-alt warning"></i>
                                </button>

                                <mat-menu #menu="matMenu">
                                    <button mat-menu-item (click)="askForSoftDelete()" *ngIf="!result?.deleted">
                                        <a title="Just mark it as deleted">Mark as deleted</a>
                                    </button>
                                    <button mat-menu-item (click)="askForPermanentDelete()">
                                        <a title="Permanently delete the Data Model">Delete <span class="errorMessage">permanently</span></a>
                                    </button>
                                </mat-menu>
                            </div>
                        </div>

                        <div style="float: right;margin-bottom: 3px">
                            <div *ngIf="showEdit" [hidden]="editableForm.visible || editableForm.deletePending" style="margin-bottom: 3px;position: relative; float: right; margin-right:4px;">
                                <button mat-stroked-button
                                        color="primary"
                                        type="button"
                                        [disabled]="deleteInProgress || exporting || result.finalised"
                                        matTooltip="Edit"
                                        aria-label="Edit"
                                        (click)="showForm();">
                                        <i class="fas fa-pencil-alt"></i>
                                </button>
                            </div>
                            <mdm-editable-form-buttons [hidden]="!editableForm.visible" [onCancelEdit]="onCancelEdit"
                                [editable]="editableForm" [textLocation]="'left'" [hideDelete]="true"
                                [hideCancel]="false" [processing]="deleteInProgress"></mdm-editable-form-buttons>
                        </div>

                        <div style="margin-bottom: 3px;position: relative; float: right; margin-right:4px;" [hidden]="editableForm.visible || editableForm.deletePending">
                            <button mat-stroked-button
                                    color="primary"
                                    type="button"
                                    class="paddingless"
                                    matTooltip="Search"
                                    aria-label="Search"
                                    [disabled]="processing"
                                    (click)="toggleShowSearch()" >
                                <i class="fas fa-search"></i>
                            </button>
                        </div>

                        <div style="margin-bottom: 3px;position: relative; float: right; margin-right:4px;" [hidden]="editableForm.visible || editableForm.deletePending">
                            <button mat-stroked-button
                                    color="primary"
                                    type="button"
                                    class="paddingless"
                                    matTooltip="User & Group Access"
                                    aria-label="User & Group Access"
                                    *ngIf="showPermission"
                                    [disabled]="deleteInProgress || processing"
                                    (click)="toggleSecuritySection()">
                                    <i class="fas fa-user"></i>
                            </button>
                        </div>

                    </td>
                </tr>
            </tbody>
        </table>
    </form>
</div>
