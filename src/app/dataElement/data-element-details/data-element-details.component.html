<div class="panel panel-default mdm--shadow-block">
    <form editable-form name="form" onaftersave="onAfterSave()" (ngSubmit)="formBeforeSave()" disable-submit-on-enter>
        <div class="panel-body">
            <div *ngIf="result">
                <h4 class="inline-block marginless" [ngClass]="{ 'has-error': errorMessage != ''}">
                    <mdm-inline-text-edit [inEditMode]="editableForm.visible" [(ngModel)]="editableForm.label"
                        [styleCss]="'dataModelDetailsLabel'" (input)="onLabelChange($event.target)"
                        name="moduleName" size="20"></mdm-inline-text-edit>
                </h4>
                                <div [ngClass]="{'has-error': true }" *ngIf="errorMessage != ''">
                              <span class="help-block">{{errorMessage}}</span>
                            </div>

                <div class="detail-icons">
                    <div class="text-muted">
                        <small>
                            <i class="fas fa-cube" matTooltip="Item type"></i>
                            <span><strong>Item type: </strong><span class="item-type">Data Element</span></span>
                        </small>
                            </div>
                    <div class="text-muted" *ngIf="result">
                        <small>
                            <i class="far fa-calendar-alt" matTooltip="Last update"></i>
                            <span><strong>Last update: </strong>{{result.lastUpdated | date:"yyyy-MM-dd HH:mm:ss" }}</span>
                        </small>
                    </div>
                    <div class="text-muted" *ngIf="result && result.finalised && result.dateFinalised">
                        <small>
                            <i class="far fa-calendar-alt" matTooltip="Finalised on"></i>
                            <span><strong>Finalised on: </strong> {{result.dateFinalised | date:"yyyy-MM-dd HH:mm:ss" }}</span>
                        </small>
                </div>
            </div>
            </div>
        </div>
        <table class="table table-bordered">
                <tbody>
                <tr>
                    <td class="detailsRowHeader">Aliases</td>
                    <td>
                        <div>
                            <mdm-element-alias [inEditMode]="editableForm.visible" [aliases]="aliases"
                                [element]="result" [editableForm]="editableForm" [property]="'aliases'">
                            </mdm-element-alias>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td class="detailsRowHeader">Description</td>
                    <td class="elementDetailDescription">
                        <div *ngIf="result">
                            <mdm-markdown-text-area [editableForm]="editableForm" [element]="result"
                                [property]="'description'"></mdm-markdown-text-area>
                        </div>
                    </td>
                </tr>
                <tr>
                    <th class="detailsRowHeader">Data Type</th>
                    <td>
                        <div *ngIf="!editableForm.visible && result">
                            <mdm-element-data-type [elementDataType]="result.dataType" [mcParentDataModel]="parentDataModel"></mdm-element-data-type>
                        </div>

                        <div *ngIf="editableForm.visible">


                            <span *ngIf="!showNewInlineDataType">Please select a Data Type or <a style="cursor: pointer;" (click)="toggleShowNewInlineDataType()">Add a new one</a>:</span>
                            <span *ngIf="showNewInlineDataType">Please <a style="cursor: pointer;" (click)="toggleShowNewInlineDataType()">select a Data Type </a> or Add a new one:</span>

                            <div *ngIf="showNewInlineDataType">
                                <mdm-data-type-inline
                                        [model]="newlyAddedDataType"
                                        [parentDataModel]="parentDataModel"
                                        [showClassification]="false"
                                        [showParentDataModel]="false">
                                </mdm-data-type-inline>
                            </div>
                            <div *ngIf="!showNewInlineDataType">
                                <mdm-select [width]="'100%'"
                                           [acceptTypedInput]="true"
                                           [valueType]="'dynamic'"
                                           [defaultValue]="result.dataType"
                                           [hasError]="dataTypeErrors"
                                           [loadDynamicValues]="fetchDataTypes"
                                           [loadAllOnClick]="true"
                                           [record]="result"
                                           [minInputLength]="1"
                                           [idProperty]="'id'"
                                            [pagination]="pagination"
                                           [displayProperty]="'label'"
                                           [searchProperty]="'label'"
                                           (selectEvent)="onDataTypeSelect($event[0])">
                                  <ng-template #lineContent let-item='item' let-searchTerm="inputText">
                                    <div [innerHTML]="item.label | mchighlighter:searchTerm"></div>
                                    <div>
                                      <mdm-element-link [element]="item" [showTypeTitle]="true" [showLink]="false"></mdm-element-link>
                                    </div>
                                  </ng-template>
                                </mdm-select>
                            </div>
                            <span class="help-block errorMessage" *ngIf="dataTypeErrors"><small>{{dataTypeErrors}}</small></span>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td class="detailsRowHeader">Parent Hierarchy</td>
                    <td *ngIf="result">
                        <mdm-model-path [path]="result.breadcrumbs"></mdm-model-path>
                    </td>
                </tr>
                <tr>
                    <th class="detailsRowHeader">Multiplicity</th>
                    <td class="dataClassDetailsModelPath">

                        <!--                        <div *ngIf="!editableForm.visible && result">-->
                        <!--                            <multiplicity [min]="result.minMultiplicity" [max]="result.maxMultiplicity"></multiplicity>-->
                        <!--                        </div>-->
                        <div *ngIf="result">
                            <div style="float: left;">

                                <div *ngIf="editableForm.visible" style="padding-left: 8px">Min</div>
                                <mdm-inline-text-edit  [inEditMode]="editableForm.visible" [(ngModel)]="min" [styleCss]="'dataModelDetailsLabel'" name="moduleNameMinText" size="20" size="5" ></mdm-inline-text-edit>
                                <span *ngIf="!editableForm.visible && (result.minMultiplicity || result.minMultiplicity == 0)">..</span>
                                <span *ngIf="editableForm.visible" style="padding-right: 10px"></span>
                            </div>

                            <div style="float: left;margin-right: 13px;">
                                <div *ngIf="editableForm.visible" style="padding-left: 6px">Max</div>
                                <mdm-inline-text-edit  [inEditMode]="editableForm.visible" [(ngModel)]="max" [styleCss]="'dataModelDetailsLabel'" name="moduleNameMaxText" size="20" size="5" ></mdm-inline-text-edit>
                            </div>
                            <div style="clear: both;" [ngClass]="{'has-error': true }" *ngIf="error != ''">
                                <span class="help-block">{{error}}</span>
                            </div>

                            <div style="clear: both;font-size: 11px;font-style: italic;" *ngIf="editableForm.visible" >
                                Please enter <strong style="font-size: 14px">*</strong> for unbound multiplicity.
                            </div>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td class="detailsRowHeader">Classifications</td>
                    <td *ngIf="result">
                        <mdm-element-classifications [classifications]="result.classifiers" [editableForm]="editableForm" [element]="result" [property]="'classifiers'"></mdm-element-classifications>

                    </td>
                </tr>
                <tr>
                    <td colspan="2" style="text-align: right;">

                        <div *ngIf="result" mdmShowIfRolesWritable [result]="result" style="float: right;margin-bottom: 3px">
                            <div style="float: right">
                                <mdm-editable-form-buttons [hidden]="editableForm.visible"
                                                       [onCancelEdit]="onCancelEdit"
                                                       [editable]="editableForm"
                                                       [textLocation]="'left'"
                                                       [hideDelete]="false"
                                                       [hideCancel]="false"
                                                       [hideEdit]="true"
                                                       (delete)="delete()"
                                                       [processing]="deleteInProgress"></mdm-editable-form-buttons>
                            </div>
                            <div [hidden]="editableForm.visible || editableForm.deletePending" style="position: relative; float: right; margin-right:4px;">
                                <button mat-stroked-button
                                        color="primary"
                                        type="button"
                                        class="paddingless"
                                        [disabled]="deleteInProgress"
                                        matTooltip="Edit"
                                        aria-label="Edit"
                                        (click)="showForm();">
                                    <i class="fas fa-pencil-alt" aria-hidden="true"></i>
                                </button>
                            </div>
                            <mdm-editable-form-buttons [hidden]="!editableForm.visible"
                                                   [onCancelEdit]="onCancelEdit"
                                                   [editable]="editableForm"
                                                   [textLocation]="'left'"
                                                   [hideDelete]="true"
                                                   [hideCancel]="false"
                                                   [processing]="deleteInProgress"></mdm-editable-form-buttons>
                        </div>


                        <div style="clear: both;" *ngIf="processing">
                            <mat-progress-bar value="50" bufferValue="75" color="accent" mode="indeterminate"></mat-progress-bar>
                        </div>
                        <div style="text-align: left" *ngIf="exportError">
                            <div style="padding-top: 25px;">
                                <div class="alert alert-danger">
                                    <strong>Error!</strong> {{exportError}}
                                </div>
                            </div>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>
        </form>
    </div>
