<div>
    <div class="panel panel-default">
        <form editable-form name="form"
              onaftersave="onAfterSave()"
              (ngSubmit)="formBeforeSave()"
              disable-submit-on-enter>
            <div class="panel-body panel-table">

                <div style="padding: 0px !important;" *ngIf="result">
                    <h4> <span class="xeditableInput">
                                <div [ngClass]="{ 'has-error': errorMessage != ''}">
                                <app-inline-text-edit  [inEditMode]="editableForm.visible" [(ngModel)]="editableForm.label" [styleCss]="'dataModelDetailsLabel'" (input)="onLabelChange($event.target.value)"  name="moduleName" size="20" style="width: 45%"  ></app-inline-text-edit>
                                <div [ngClass]="{'has-error': true }" *ngIf="errorMessage != ''">
                              <span class="help-block">{{errorMessage}}</span>
                            </div>
                            </div>
                        </span></h4>
                    <small class="elementDetailMCType">Data Element</small>
                    <div>
                        <span *ngIf="result" style="font-size: 11px;font-style: italic" class="dataClassDetailsLastUpdate">Last Update: {{result.lastUpdated | date:"yyyy-MM-dd HH:mm:ss" }}</span>
                        <span *ngIf="result && result.finalised && result.dateFinalised" style="font-size: 11px;font-style: italic; margin-left: 10px" class="dataModelDetailsLastUpdate">Finalised On: {{result.dateFinalised | date:"yyyy-MM-dd HH:mm:ss" }}</span>
                    </div>
                </div>
            </div>
            <table class="table dataModelDetailTable">
                <tbody>
                <tr>
                    <td class="detailsRowHeader">Aliases</td>
                    <td>
                        <div style="width:50%">
                            <app-element-alias [inEditMode]="editableForm.visible" [aliases]="aliases" [element]="result" [editable-form]="editableForm" [property]="'aliases'"></app-element-alias>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td class="detailsRowHeader">Description</td>
                    <td class="elementDetailDescription">
                        <div *ngIf="result">
                            <markdown-text-area [editable-form]="editableForm" [element]="result" [property]="'description'"></markdown-text-area>
                        </div>
                    </td>
                </tr>
                <tr>
                    <th class="detailsRowHeader">Data Type</th>
                    <td>
                        <div *ngIf="!editableForm.visible && result">
                            <element-data-type [element-data-type]="result.dataType" [mc-parent-data-model]="parentDataModel"></element-data-type>
                        </div>

                        <div *ngIf="editableForm.visible">


                            <span *ngIf="!showNewInlineDataType">Please select a Data Type or <a style="cursor: pointer;" (click)="toggleShowNewInlineDataType()">Add a new one</a>:</span>
                            <span *ngIf="showNewInlineDataType">Please <a style="cursor: pointer;" (click)="toggleShowNewInlineDataType()">select a Data Type </a> or Add a new one:</span>

                            <div *ngIf="showNewInlineDataType">
                                <new-data-type-inline
                                        [model]="newlyAddedDataType"
                                        [parent-data-model]="parentDataModel"
                                        [show-classification]="false"
                                        [show-parent-data-model]="false">
                                </new-data-type-inline>
                            </div>


                            <div *ngIf="!showNewInlineDataType">
<!--                                <mc-select-2-->
<!--                                        width="'100%'"-->
<!--                                        has-error="errors.dataType"-->
<!--                                        accept-typed-input="false"-->
<!--                                        value-type="'dynamic'"-->
<!--                                        default-value="mcDataElement.dataType"-->
<!--                                        load-dynamic-values="fetchDataTypes"-->
<!--                                        min-input-length="1"-->
<!--                                        record="model"-->
<!--                                        id-property="'id'"-->
<!--                                        display-property="'label'"-->
<!--                                        search-property="'label'"-->
<!--                                        load-all-on-click="true"-->
<!--                                        on-select="onDataTypeSelect">-->
<!--                                    <div>-->
<!--                                        <div>{{$item.label}}</div>-->
<!--                                        <div>-->
<!--                                            <element-link mc-element="$item" show-type-title="true" show-link="false"></element-link>-->
<!--                                        </div>-->
<!--                                    </div>-->
<!--                                </mc-select-2>-->

                                <mdm-select [width]="'100%'"
                                           [accept-typed-input]="true"
                                           [value-type]="'dynamic'"
                                           [default-value]="result.dataType"
                                           [has-error]="dataTypeErrors"
                                           [load-dynamic-values]="fetchDataTypes"
                                           [(record)]="result"
                                           [min-input-length]="1"
                                           [id-property]="'id'"
                                           [display-property]="'label'"
                                           [search-property]="'label'"
                                           (on-select)="onDataTypeSelect">
                                    <ng-template #lineContent let-item>
                                        <div>{{item.label}}</div>
                                    </ng-template>
                                </mdm-select>
                            </div>
                            <span class="help-block errorMessage" *ngIf="dataTypeErrors"><small>{{dataTypeErrors}}</small></span>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td class="detailsRowHeader">Parent Hierarchy</td>
                    <td *ngIf="result">
                        <model-path [path]="result.breadcrumbs"></model-path>
                    </td>
                </tr>
                <tr>
                    <th class="detailsRowHeader">Multiplicity</th>
                    <td class="dataClassDetailsModelPath">

                        <!--                        <div *ngIf="!editableForm.visible && result">-->
                        <!--                            <multiplicity [min]="result.minMultiplicity" [max]="result.maxMultiplicity"></multiplicity>-->
                        <!--                        </div>-->
                        <div *ngIf="result">
                            <div style="float: left;">

                                <div *ngIf="editableForm.visible" style="padding-left: 8px">Min</div>
                                <app-inline-text-edit  [inEditMode]="editableForm.visible" [(ngModel)]="min" [styleCss]="'dataModelDetailsLabel'" name="moduleNameMinText" size="20" style="width: 45%" size="5" ></app-inline-text-edit>
                                <span *ngIf="!editableForm.visible && (result.minMultiplicity || result.minMultiplicity == 0)">..</span>
                                <span *ngIf="editableForm.visible" style="padding-right: 10px"></span>
                            </div>

                            <div style="float: left;margin-right: 13px;">
                                <div *ngIf="editableForm.visible" style="padding-left: 6px">Max</div>
                                <app-inline-text-edit  [inEditMode]="editableForm.visible" [(ngModel)]="max" [styleCss]="'dataModelDetailsLabel'" name="moduleNameMaxText" size="20" style="width: 45%" size="5" ></app-inline-text-edit>
                            </div>
                            <div style="clear: both;" [ngClass]="{'has-error': true }" *ngIf="error != ''">
                                <span class="help-block">{{error}}</span>
                            </div>

                            <div style="clear: both;font-size: 11px;font-style: italic;" *ngIf="editableForm.visible" >
                                Please enter <strong style="font-size: 14px">*</strong> for unbound multiplicity.
                            </div>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td class="detailsRowHeader">Classifications</td>
                    <td *ngIf="result">
                        <app-element-classifications [classifications]="result.classifiers" [editable-form]="editableForm" [element]="result" [property]="'classifiers'"></app-element-classifications>

                    </td>
                </tr>
                <tr>
                    <td colspan="2" style="text-align: right;">

                        <div *ngIf="result" appShowIfRolesWritable [result]="result" style="float: right;margin-bottom: 3px">
                            <div style="float: right">
                                <editable-form-buttons [hidden]="editableForm.visible"
                                                       [on-cancel-edit]="onCancelEdit"
                                                       [editable]="editableForm"
                                                       [text-location]="'left'"
                                                       [hide-delete]="false"
                                                       [hide-cancel]="false"
                                                       [hide-edit] = "true"
                                                       (delete)="delete()"
                                                       [processing]="deleteInProgress"></editable-form-buttons>
                            </div>
                            <div [hidden]="editableForm.visible || editableForm.deletePending"
                                 class="btn-group-xs" uib-dropdown is-open="false"
                                 style="margin-bottom: 3px;position: relative; float: right; margin-right:4px;">
                                <button id="singleX-button" type="button"
                                        class="btn btn-xs dropdown-toggle btn-default addNewModelButton"
                                        [hidden]="editableForm.visible || editableForm.deletePending"
                                        [disabled]="deleteInProgress"
                                        matTooltip="Edit"
                                        (click)="showForm();"
                                        uib-dropdown-toggle>
                                    <i class="fas fa-pencil-alt" aria-hidden="true"></i>
                                </button>
                            </div>
                            <editable-form-buttons [hidden]="!editableForm.visible"
                                                   [on-cancel-edit]="onCancelEdit"
                                                   [editable]="editableForm"
                                                   [text-location]="'left'"
                                                   [hide-delete]="true"
                                                   [hide-cancel]="false"
                                                   [processing]="deleteInProgress"></editable-form-buttons>
                        </div>


                        <div style="clear: both;" *ngIf="processing">
                            <mat-progress-bar
                                    value="50"
                                    bufferValue="75"
                                    color="primary"
                                    mode="indeterminate">
                            </mat-progress-bar>
                        </div>
                        <div style="text-align: left" *ngIf="exportError">
                            <div style="padding-top: 25px;">
                                <div class="alert alert-danger">
                                    <a class="close" ng-click="resetExportError()" aria-label="close">&times;</a>
                                    <strong>Error!</strong> {{exportError}}
                                </div>
                            </div>
                        </div>
                    </td>
                </tr>
                </tbody>
            </table>

        </form>
    </div>
</div>
